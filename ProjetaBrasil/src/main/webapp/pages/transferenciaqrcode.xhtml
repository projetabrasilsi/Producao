<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:cc="http://java.sun.com/jsf/composite"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	template="/templates/template.xhtml">
	<h:head>
		<script src="http://code.jquery.com/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="./js/pessoas.js" />
	</h:head>
	<f:event listener="#{paginas.mudaPaginaAtual}" type="preRenderView" />

	<ui:define name="conteudo">


		<div class="ui-g">
			<div class="ui-g-12">
				<div class="card card-pessoas">
					<h1>
						<p:outputLabel
							value="Listagem de #{autenticacaojsfController.perfilLogado.paginaAtual.descricao2}" />
					</h1>
					
					<h:form id="formLista">
						<p:commandButton value="Transferir" rendered="#{qrcodejsfController.renderizacheck}"
										actionListener="#{qrcodejsfController.identidade}"
										styleClass="btao-pessoas btn-color-green btn-qr"
										update=":mensagens
										:formTemplate:formIdentidade">
						</p:commandButton>
						<p:dataTable id="tabela" emptyMessage="Sem Registros"
							resizableColumns="true" value="#{qrcodejsfController.qRCodes}"
							paginator="true" rows="15" var="registro"
							styleClass="tabela-pessoas tabela-vizualizacao"
							selection="#{qrcodejsfController.qRCodesSelecionados}"
							rowKey="#{registro.id}">
							
							
							<p:column headerText="Vincular" rendered="#{!qrcodejsfController.renderizacheck}"
							styleClass="col-qr-vinq">

								<p:commandButton icon="ui-icon-check"
									actionListener="#{qrcodejsfController.abreDialogodeBuscadePessoas}"
									update=":formTemplate:formIdentidadeEObjeto" styleClass="btn-qr-vinq btn-color-blue">
									<p:confirm header="Confirmação"
										message="Deseja realmente Vincular este registro?"
										icon="ui-icon-alert" />
									<f:attribute name="registroAtual" value="#{registro}" />
								</p:commandButton>
							</p:column>
							

							<p:column selectionMode="#{qrcodejsfController.selectionMode}"
								style="width:16px;text-align:center"
								rendered="#{qrcodejsfController.renderizacheck}" />

							<p:column headerText="ID" sortBy="id" filterBy="id"
								styleClass="col-qr-id">
								<h:outputText value="#{registro.id}" />
							</p:column>
							<p:column headerText="Status" sortBy="status"
								filterBy="identificador" styleClass="col-qr-status"
								>
								<p:outputLabel id="status" size="30" maxlength="15"
									value="#{registro.status}" />
							</p:column>
							
							
							
							<p:column headerText="Foto" rendered="#{!qrcodejsfController.renderizacheck}"
							styleClass="col-qr-foto" >
							<p:graphicImage id="Fotoobjeto"
								value="#{imagensjsfController.image}"
								styleClass="img-qr-foto"
								>
								<f:param name="caminho" value="#{registro.caminhodaImagem}" />
							</p:graphicImage>

						</p:column>
						<p:column headerText="objeto" rendered="#{!qrcodejsfController.renderizacheck}"
								sortBy="#{registro.id_Objeto.descricao}"
								filterBy="registro.id_Objeto.descricao"
								styleClass="col-qr-ojeto">
								<h:outputText
									value="#{fn:substring(registro.id_Objeto.descricao,0,15)}">

								</h:outputText>
							</p:column>
						
						
							<p:column headerText="Cliente"
								sortBy="#{registro.id_Pessoa_Cliente.descricao}"
								filterBy="registro.id_Pessoa_Cliente.descricao"
								styleClass="col-qr-cliente">
								<h:outputText
									value="#{fn:substring(registro.id_Pessoa_Cliente.descricao,0,15)}">

								</h:outputText>
							</p:column>
							
							<p:column headerText="Data Ultimo Status"
								sortBy="ultimaAtualizacao" filterBy="ultimaAtualizacao"
								styleClass="col-qr-data">
								<h:outputText value="#{registro.ultimaAtualizacao.time}">
									<f:convertDateTime locale="pt_BR" dateStyle="long" type="both"
										pattern="dd/MM/yyyy" />
								</h:outputText>
							</p:column>
							<p:column headerText="Distribuidor"
								sortBy="registro.id_Pessoa_Distribuicao.descricao"
								filterBy="registro.id_Pessoa_Distribuicao.descricao"
								styleClass="col-qr-distribuidor">
								<h:outputText
									value="#{fn:substring(registro.id_Pessoa_Distribuicao.descricao,0,15)}">

								</h:outputText>
							</p:column>

							<p:column headerText="Representante"
								sortBy="#{registro.id_Pessoa_Representacao.descricao}"
								filterBy="registro.id_Pessoa_Representacao.descricao"
								styleClass="col-qr-representante">
								<h:outputText
									value="#{fn:substring(registro.id_Pessoa_Representacao.descricao,0,15)}">

								</h:outputText>
							</p:column>

							<p:column headerText="Revenda"
								sortBy="#{registro.id_Pessoa_Revenda.descricao}"
								filterBy="registro.id_Pessoa_Revenda.descricao"
								styleClass="col-qr-revenda">
								<h:outputText
									value="#{fn:substring(registro.id_Pessoa_Revenda.descricao,0,15)}">

								</h:outputText>
							</p:column>

							
							
							





						</p:dataTable>
						
						<p:confirmDialog global="true" styleClass="cDialog-edit-pessoas">
							<p:commandButton value="SIM" type="button"
								styleClass="ui-confirmdialog-yes btn-color-blue2"
								icon="ui-icon-check" />
							<p:commandButton value="NAO" type="button"
								styleClass="ui-confirmdialog-no btn-color-blue2"
								icon="ui-icon-close" />
						</p:confirmDialog>

					</h:form>

				</div>
			</div>
		</div>


		<p:dialog widgetVar="dialogoIdentidade" closable="false"
			resizable="false" modal="true" appendTo="@(body)"
			header="Escolha o Tipo de Identificação" dynamic="true"
			responsive="true" styleClass="dialog-cpf-pessoas">

			<h:form id="formIdentidade">

				<p:focus for="identificador" />
				<p:selectOneRadio id="perfil"
					value="#{qrcodejsfController.pessoa.enum_Aux_Tipo_Identificador}"
					layout="pageDirection" columns="5"
					converter="omnifaces.SelectItemsConverter">
					<f:selectItems
						value="#{qrcodejsfController.pessoaConfig.listaTipodeIdentificadores}"
						var="c" itemLabel="#{c.descricao}" itemValue="#{c}" />
					<p:ajax event="change" update="identificador" process="@this"
						oncomplete="$(function(){PrimeFaces.focus('formTemplate:formIdentidade:identificador');});" />
				</p:selectOneRadio>

				<div class="ui-g-12">
					<p:outputLabel value="Informe CPF/CNPJ " />
					<p:inputMask id="identificador" size="30" maxlength="20"
						value="#{qrcodejsfController.pessoa.cpf_Cnpj}" required="true"
						requiredMessage="É preciso informar a identificação!!!"
						mask="#{qrcodejsfController.pessoa.enum_Aux_Tipo_Identificador.mask}"
						styleClass="input-cpf-pessoas" />
				</div>

				<div class="ui-g-5">
					<p:commandButton value="Transferir" styleClass="btn-color-blue2"
						actionListener="#{qrcodejsfController.RealizarTransferencia()}"
						update=":mensagens :formTemplate:formIdentidade" process="@form">
					</p:commandButton>
				</div>
				<div class="ui-g-5">
					<p:commandButton value="Cancelar"
						oncomplete="PF('dialogoIdentidade').hide();"
						styleClass="btn-color-blue2">
					</p:commandButton>
				</div>
			</h:form>
		</p:dialog>

		<p:dialog widgetVar="dialogoIdentidadeEObjeto" closable="false"
			modal="true" appendTo="@(body)"
			header="Escolha o Tipo de Identificação" dynamic="true"
			responsive="true" styleClass="dialog-cpf-pessoas">

			<h:form id="formIdentidadeEObjeto"
				title="Busca de cliente e seus pertences">

				<p:focus for="cpf_cnpj" />
				<p:selectOneRadio id="tipo_Identificador"
					value="#{qrcodejsfController.pessoa.enum_Aux_Tipo_Identificador}"
					layout="pageDirection" columns="5"
					converter="omnifaces.SelectItemsConverter">
					<f:selectItems
						value="#{qrcodejsfController.pessoaConfig.listaTipodeIdentificadores}"
						var="c" itemLabel="#{c.descricao}" itemValue="#{c}" />
					<p:ajax event="change" update="cpf_cnpj" process="@this"
						oncomplete="$(function(){PrimeFaces.focus('formTemplate:formIdentidade:cpf_cnpj');});" />
				</p:selectOneRadio>

				<div class="ui-g-12">
					<p:outputLabel value="Informe CPF/CNPJ " />
					<p:inputMask id="cpf_cnpj" size="30" maxlength="20"
						value="#{qrcodejsfController.pessoa.cpf_Cnpj}" required="true"
						requiredMessage="É preciso informar a identificação!!!"
						mask="#{qrcodejsfController.pessoa.enum_Aux_Tipo_Identificador.mask}"
						styleClass="input-cpf-pessoas">
					</p:inputMask>
				</div>


				<div class="ui-g-12">
					
					
					<p:commandButton value="Vincular" process="@form" 
						actionListener="#{qrcodejsfController.buscaClienteEObjetos}"
						update=":mensagens :formTemplate:formLista  :formTemplate:formObjetos:tabelaObjetos"   
						styleClass="btn-color-blue2">
					</p:commandButton>

					<p:commandButton value="Cancelar"
						oncomplete="PF('dialogoIdentidade').hide();"
						styleClass="btn-color-blue2">
					</p:commandButton>
				</div>
			</h:form>


		</p:dialog>


		<p:dialog widgetVar="dialogoObjetos" closable="false" modal="true"
			appendTo="@(body)" header="Escolha qual PET deseja vincular" responsive="true" 
			style="max-width:800px;!important">
			
			<div class="card card-pessoas"  >
				<h:form id="formObjetos" >
				<p:commandButton value="Cancelar"
										actionListener="#{qrcodejsfController.cancelarVinculo()}"
										styleClass="btao-pessoas btn-color-green btn-qr"
										update=":mensagens
										:formTemplate:formLista">
						</p:commandButton>
					<p:dataTable id="tabelaObjetos" emptyMessage="Sem Registros"
						resizableColumns="true" value="#{qrcodejsfController.objetos}"
						paginator="true" rows="15" var="registro"
						styleClass="tabela-pessoas">
						<f:facet name="header">
							<p:outputLabel
								value="Objetos/Pets pertecentes a: #{qrcodejsfController.pessoa.descricao} " />
						</f:facet>
						
						<p:column headerText="escolher"  width="50" >

								<p:commandButton icon="fa-qrcode" process="@form"
									actionListener="#{qrcodejsfController.vincularObjetos}"
									update=":mensagens :formTemplate:formLista:tabela">
									<p:confirm header="Confirmação"
										message="Confirma vinculação deste registro?"
										icon="ui-icon-alert" />
									<f:attribute name="registroAtual" value="#{registro}" />
								</p:commandButton>
							</p:column>

						<p:column headerText="Descrição" sortBy="id" filterBy="id"
							 style="max-width:60px;!important">
							<h:outputText value="#{registro.descricao}" />
						</p:column>
						<p:column headerText="Foto"  style="max-width:120px;!important">
							<p:graphicImage id="Fototab"
								value="#{imagensjsfController.image}"
								style="max-width:90px;max-height:80px;width: auto;height: auto;">
								<f:param name="caminho" value="#{registro.caminhodaImagem}" />
							</p:graphicImage>

						</p:column>
						<p:column headerText="Ultima Atualização"  style="max-width:50px;!important"
							sortBy="ultimaAtualizacao" filterBy="ultimaAtualizacao"
							>
							<h:outputText value="#{registro.ultimaAtualizacao.time}">
								<f:convertDateTime locale="pt_BR" dateStyle="long" type="both"
									pattern="dd/MM/yyyy" />
							</h:outputText>
						</p:column>
						<p:column headerText="Responsavel" style="max-width:80px;!important"
							sortBy="#{registro.id_Pessoa_Registro.descricao}"
							filterBy="registro.id_Pessoa_REgistro.descricao}"
							>
							<h:outputText
								value="#{fn:substring(registro.id_Pessoa_Registro.descricao,0,15)}">
							</h:outputText>
						</p:column>
						
						
					</p:dataTable>
					<p:confirmDialog global="true" styleClass="cDialog-edit-pessoas">
							<p:commandButton value="SIM" type="button"
								styleClass="ui-confirmdialog-yes btn-color-blue2"
								icon="ui-icon-check" />
							<p:commandButton value="NAO" type="button"
								styleClass="ui-confirmdialog-no btn-color-blue2"
								icon="ui-icon-close" />
						</p:confirmDialog>


				</h:form>

			</div>
			

		</p:dialog>

	</ui:define>
</ui:composition>